rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
  
    // Rule for your read tracking collection
    match /readLogs/{logId} {
      
      // Allow anyone to read the logs for the chart
      allow read: if true;
      
      // Allow anyone to create a new log if the data is valid
      allow create: if isReadLogDataValid();
      
      // Prevent logs from being changed or deleted
      allow update, delete: if false;
    }

    // Helper function to validate new log data
    function isReadLogDataValid() {
      let data = request.resource.data;
      
      // Ensure the log only contains the expected fields
      return data.keys().hasOnly(['docId', 'timestamp', 'userId']) &&
             data.docId is string && data.docId.size() > 0 &&
             // Ensure the timestamp is being set by the server
             data.timestamp == request.time;
    }
    
    // Add your other rules (e.g., for 'posts') here...
  }
}
