<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <style>* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background: #f5f7fa;
  color: #2c3e50;
}

/* Login Page Styles */
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-box {
  background: white;
  padding: 40px;
  border-radius: 10px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  width: 100%;
  max-width: 400px;
}

.login-box h1 {
  margin-bottom: 10px;
  color: #333;
  font-size: 28px;
}

.login-box p {
  color: #666;
  margin-bottom: 30px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  color: #555;
  font-weight: 500;
}

.form-group input {
  width: 100%;
  padding: 12px;
  border: 2px solid #e1e8ed;
  border-radius: 6px;
  font-size: 14px;
  transition: border-color 0.3s;
}

.form-group input:focus {
  outline: none;
  border-color: #667eea;
}

.login-btn {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s;
}

.login-btn:hover {
  transform: translateY(-2px);
}

.login-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.error-message {
  background: #fee;
  color: #c33;
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 20px;
  display: none;
}

/* Dashboard Styles */
.dashboard {
  display: none;
}

.dashboard.active {
  display: block;
}

.dashboard-header {
  background: white;
  padding: 20px 30px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 100;
}

.dashboard-title {
  font-size: 24px;
  font-weight: 600;
  color: #2c3e50;
}

.header-actions {
  display: flex;
  gap: 15px;
  align-items: center;
}

.notification-bell {
  position: relative;
  background: #f8f9fa;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: background 0.3s;
}

.notification-bell:hover {
  background: #e9ecef;
}

.notification-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #e74c3c;
  color: white;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  font-size: 11px;
  font-weight: bold;
  display: none;
  align-items: center;
  justify-content: center;
  animation: pulse 2s infinite;
}

.notification-badge.active {
  display: flex;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.admin-email {
  color: #666;
  font-size: 14px;
}

.logout-btn {
  background: #e74c3c;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.3s;
}

.logout-btn:hover {
  background: #c0392b;
}

.dashboard-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  padding: 30px;
  max-width: 1400px;
  margin: 0 auto;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  transition: transform 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-label {
  color: #7f8c8d;
  font-size: 14px;
  margin-bottom: 10px;
}

.stat-value {
  font-size: 36px;
  font-weight: 700;
  color: #2c3e50;
}

.stat-icon {
  width: 50px;
  height: 50px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 15px;
}

.dashboard-controls {
  padding: 0 30px 20px;
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 10px 20px;
  border: 2px solid #e1e8ed;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s;
}

.filter-btn:hover {
  border-color: #667eea;
  color: #667eea;
}

.filter-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: transparent;
}

.search-box {
  flex: 1;
  min-width: 250px;
  padding: 10px 15px;
  border: 2px solid #e1e8ed;
  border-radius: 6px;
  font-size: 14px;
}

.posts-container {
  padding: 0 30px 30px;
  max-width: 1400px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  align-items: stretch;
}

.admin-post-wrapper {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.admin-post-card {
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  transition: box-shadow 0.3s;
  display: flex;
  flex-direction: column;
  height: 300px;
  width:300px;
  overflow: hidden;
}

.admin-post-card:hover {
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.scrollable-content {
  flex: 1;
  overflow-y: auto;
  margin: 10px 0;
  padding-right: 5px;
  scrollbar-width: thin;
}

.scrollable-content::-webkit-scrollbar {
  width: 6px;
}
.scrollable-content::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.2);
  border-radius: 3px;
}

.post-hashtags {
  margin-top: 8px;
}
.post-hashtag {
  background: #f0f0f0;
  border-radius: 5px;
  padding: 3px 8px;
  font-size: 12px;
  margin-right: 5px;
}

.post-actions {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 6px;
}

.action-btn {
  flex: 1;
  min-width: 80px;
  background: #f5f5f5;
  border: none;
  border-radius: 6px;
  padding: 8px;
  cursor: pointer;
  transition: background 0.2s;
}

.action-btn:hover {
  background: #e0e0e0;
}

.hide-btn { color: #f39c12; }
.unhide-btn { color: #27ae60; }
.delete-btn { color: #e74c3c; }
.view-link-btn { color: #3498db; }

.loading, .empty-state {
  text-align: center;
  padding: 60px;
  color: #7f8c8d;
  font-size: 18px;
  grid-column: 1 / -1; /* Make it span all columns */
}

.empty-state svg {
  width: 80px;
  height: 80px;
  margin-bottom: 20px;
  opacity: 0.3;
}

.toast {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background: #2ecc71;
  color: white;
  padding: 15px 25px;
  border-radius: 8px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.2);
  display: none;
  align-items: center;
  gap: 10px;
  animation: slideIn 0.3s;
  z-index: 1000;
}

.toast.show {
  display: flex;
}

.toast.error {
  background: #e74c3c;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Responsive Media Queries */
@media (max-width: 1024px) {
  .posts-container {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 768px) {
  .dashboard-header {
    flex-direction: column;
    gap: 15px;
    align-items: start;
  }
  .dashboard-stats, .posts-container {
    grid-template-columns: repeat(2, 1fr);
    padding: 20px;
  }
  .dashboard-controls {
    padding: 0 20px 20px;
  }
}

@media (max-width: 480px) {
  .posts-container {
    grid-template-columns: 1fr;
  }
}
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="login-page" class="login-container">
    <div class="login-box">
      <h1>üîê Admin Login</h1>
      <p>Sign in to access the dashboard</p>
      
      <div id="login-error" class="error-message"></div>
      
      <form id="login-form">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" required autocomplete="email">
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" required autocomplete="current-password">
        </div>
        
        <button type="submit" class="login-btn" id="login-btn">
          Sign In
        </button>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="dashboard">
    <header class="dashboard-header">
      <h1 class="dashboard-title">üìä Admin Dashboard</h1>
      <div class="header-actions">
        <button class="notification-bell" id="notification-bell" title="New submissions">
          üîî
          <span class="notification-badge" id="notification-badge">0</span>
        </button>
        <span class="admin-email" id="admin-email"></span>
        <button class="logout-btn" id="logout-btn">Logout</button>
      </div>
    </header>

    <div class="dashboard-stats">
      <div class="stat-card">
        <div class="stat-icon">üìù</div>
        <div class="stat-label">Total Posts</div>
        <div class="stat-value" id="stat-total">0</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üëÅÔ∏è</div>
        <div class="stat-label">Visible Posts</div>
        <div class="stat-value" id="stat-visible">0</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üôà</div>
        <div class="stat-label">Hidden Posts</div>
        <div class="stat-value" id="stat-hidden">0</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üîî</div>
        <div class="stat-label">Today's Submissions</div>
        <div class="stat-value" id="stat-today">0</div>
      </div>
    </div>

    <div class="dashboard-controls">
      <button class="filter-btn active" data-filter="all">All Posts</button>
      <button class="filter-btn" data-filter="visible">Visible Only</button>
      <button class="filter-btn" data-filter="hidden">Hidden Only</button>
      <input type="search" class="search-box" id="admin-search" placeholder="üîç Search posts, authors, hashtags...">
    </div>

    <div class="posts-container" id="posts-container">
      <div class="loading">Loading posts...</div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      onSnapshot,
      deleteDoc,
      doc,
      updateDoc,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDb2cl7lsypR1ZoqHGD-mKhzN_lnDcyVEQ",
      authDomain: "website-6a5f1.firebaseapp.com",
      databaseURL: "https://website-6a5f1-default-rtdb.firebaseio.com",
      projectId: "website-6a5f1",
      storageBucket: "website-6a5f1.firebasestorage.app",
      messagingSenderId: "510903945172",
      appId: "1:510903945172:web:a5f5120db75c938721f841",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Global variables
    let allPosts = [];
    let currentFilter = 'all';
    let lastPostCount = 0;
    let audioContext = null;

    // Elements
    const loginPage = document.getElementById('login-page');
    const dashboard = document.getElementById('dashboard');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const adminEmail = document.getElementById('admin-email');
    const postsContainer = document.getElementById('posts-container');
    const notificationBell = document.getElementById('notification-bell');
    const notificationBadge = document.getElementById('notification-badge');
    const adminSearch = document.getElementById('admin-search');
    const toast = document.getElementById('toast');

    // Play notification sound
    function playNotificationSound() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }

    // Show toast notification
    function showToast(message, isError = false) {
      toast.textContent = message;
      toast.className = 'toast show' + (isError ? ' error' : '');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Login handler
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      loginBtn.disabled = true;
      loginBtn.textContent = 'Signing in...';
      loginError.style.display = 'none';

      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        loginError.textContent = getErrorMessage(error.code);
        loginError.style.display = 'block';
        loginBtn.disabled = false;
        loginBtn.textContent = 'Sign In';
      }
    });

    function getErrorMessage(code) {
      const messages = {
        'auth/invalid-email': 'Invalid email address',
        'auth/user-disabled': 'This account has been disabled',
        'auth/user-not-found': 'No account found with this email',
        'auth/wrong-password': 'Incorrect password',
        'auth/invalid-credential': 'Invalid email or password',
        'auth/too-many-requests': 'Too many attempts. Please try again later'
      };
      return messages[code] || 'Login failed. Please try again.';
    }

    // Auth state observer
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginPage.style.display = 'none';
        dashboard.classList.add('active');
        adminEmail.textContent = user.email;
        loadPosts();
      } else {
        loginPage.style.display = 'flex';
        dashboard.classList.remove('active');
      }
    });

    // Logout handler
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
        showToast('Logged out successfully');
      } catch (error) {
        showToast('Error logging out', true);
      }
    });

    // Load posts with real-time updates
    function loadPosts() {
      const postsRef = collection(db, 'posts');
      const q = query(postsRef, orderBy('timestamp', 'desc'));

      onSnapshot(q, (snapshot) => {
        const newPostCount = snapshot.size;
        
        // Check for new submissions
        if (lastPostCount > 0 && newPostCount > lastPostCount) {
          const diff = newPostCount - lastPostCount;
          notificationBadge.textContent = diff;
          notificationBadge.classList.add('active');
          playNotificationSound();
          showToast(`üîî ${diff} new submission${diff > 1 ? 's' : ''}!`);
        }
        
        lastPostCount = newPostCount;

        allPosts = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));

        updateStats();
        renderPosts();
      });
    }

    // Update statistics
    function updateStats() {
      const total = allPosts.length;
      const hidden = allPosts.filter(p => p.hidden).length;
      const visible = total - hidden;
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayPosts = allPosts.filter(p => {
        if (!p.timestamp) return false;
        const postDate = p.timestamp.toDate();
        return postDate >= today;
      }).length;

      document.getElementById('stat-total').textContent = total;
      document.getElementById('stat-visible').textContent = visible;
      document.getElementById('stat-hidden').textContent = hidden;
      document.getElementById('stat-today').textContent = todayPosts;
    }

    // Render posts
    function renderPosts() {
      const searchTerm = adminSearch.value.toLowerCase();
      
      let filtered = allPosts.filter(post => {
        // Filter by status
        if (currentFilter === 'visible' && post.hidden) return false;
        if (currentFilter === 'hidden' && !post.hidden) return false;
        
        // Filter by search
        if (searchTerm) {
          const searchable = [
            post.name,
            post.suggestion,
            post.socialLink,
            ...(post.hashtags || [])
          ].join(' ').toLowerCase();
          
          if (!searchable.includes(searchTerm)) return false;
        }
        
        return true;
      });

      if (filtered.length === 0) {
        postsContainer.innerHTML = `
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
            </svg>
            <h3>No posts found</h3>
            <p>Try adjusting your filters or search term</p>
          </div>
        `;
        return;
      }

postsContainer.innerHTML = filtered.map(post => `
  <div class="admin-post-wrapper">
    <div class="admin-post-card ${post.hidden ? 'hidden' : ''}" data-id="${post.id}">
      <div class="post-header">
        <div class="post-info">
          <div class="post-author">${escapeHtml(post.name || 'Unknown')}</div>
          <div class="post-meta">
            <span>üìÖ ${formatDate(post.timestamp)}</span>
            <span>üìÇ ${escapeHtml(post.category || 'N/A')}</span>
            ${post.hidden 
              ? '<span style="color: #f39c12;">üôà Hidden</span>' 
              : '<span style="color: #27ae60;">üëÅÔ∏è Visible</span>'}
          </div>
        </div>
      </div>

      <div class="post-content scrollable-content">
        ${escapeHtml(post.suggestion || '')}
      </div>

      ${post.hashtags && post.hashtags.length > 0 ? `
        <div class="post-hashtags">
          ${post.hashtags.map(tag => `<span class="post-hashtag">${escapeHtml(tag)}</span>`).join('')}
        </div>
      ` : ''}

      <div class="post-link">
        üîó <a href="${escapeHtml(post.socialLink || '#')}" target="_blank">
          ${escapeHtml(post.socialLink || 'N/A')}
        </a>
      </div>
    </div>

    <div class="post-actions">
      ${post.hidden 
        ? `<button class="action-btn unhide-btn" onclick="toggleHidePost('${post.id}', false)">üëÅÔ∏è Unhide</button>`
        : `<button class="action-btn hide-btn" onclick="toggleHidePost('${post.id}', true)">üôà Hide</button>`
      }
      <button class="action-btn delete-btn" onclick="deletePost('${post.id}')">üóëÔ∏è Delete</button>
      <button class="action-btn view-link-btn" onclick="window.open('${escapeHtml(post.socialLink || '#')}', '_blank')">üîó View Link</button>
    </div>
  </div>
`).join('');
    }

    // Toggle hide/unhide post
    window.toggleHidePost = async (postId, hide) => {
      try {
        const postRef = doc(db, 'posts', postId);
        await updateDoc(postRef, { hidden: hide });
        showToast(hide ? 'Post hidden successfully' : 'Post unhidden successfully');
      } catch (error) {
        console.error('Error toggling post:', error);
        showToast('Error updating post', true);
      }
    };

    // Delete post
    window.deletePost = async (postId) => {
      if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
        return;
      }

      try {
        await deleteDoc(doc(db, 'posts', postId));
        showToast('Post deleted successfully');
      } catch (error) {
        console.error('Error deleting post:', error);
        showToast('Error deleting post', true);
      }
    };

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        renderPosts();
      });
    });

    // Search functionality
    adminSearch.addEventListener('input', renderPosts);

    // Clear notification badge on click
    notificationBell.addEventListener('click', () => {
      notificationBadge.classList.remove('active');
    });

    // Utility functions
    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text ? String(text).replace(/[&<>"']/g, m => map[m]) : '';
    }

    function formatDate(timestamp) {
      if (!timestamp) return 'Unknown';
      const date = timestamp.toDate();
      const now = new Date();
      const diff = now - date;
      
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 1) return 'Just now';
      if (minutes < 60) return `${minutes}m ago`;
      if (hours < 24) return `${hours}h ago`;
      if (days < 7) return `${days}d ago`;
      
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }
  </script>
</body>
</html>